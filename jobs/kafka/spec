---
name: kafka

packages:
- openjdk
- kafka

templates:
  bin/pre-start: bin/pre-start
  bin/ctl: bin/ctl
  bin/post-deploy: bin/post-deploy
  config/bpm.yml: config/bpm.yml
  config/server.properties: config/server.properties
  config/log4j.properties: config/log4j.properties
  config/ca_certs.pem: config/ca_certs.pem
  config/cert.pem: config/cert.pem
  config/key.pem: config/key.pem
  config/kafka_server_jaas.conf: config/kafka_server_jaas.conf

consumes:
- name: zookeeper
  type: zookeeper

provides:
- name: kafka
  type: conn
  properties:
  - listen_port
  - tls.ca_certs
  - tls.certificate
  - keystore_password
  - enable_sasl_scram
  - jaas_admin.username
  - jaas_admin.password

properties:
  listen_port:
    description: "The port to listen for client connections"
    default: 9092
  
  jmx_port:
    description: "The port to listen for JMX connections, disabled by default"
    default: ''

  topics:
    default: []
    description: |-
      List of topics to create
      - name: test
        replication_factor: 1
        partitions: 1

  delete_topic:
    description: "Switch to enable topic deletion or not"
    default: false

  tls.ca_certs:
    description: |
      List of CA certs used to verify clients (and other Kafka brokers) that connect to us
    default: []

  tls.certificate:
    description: |
      Certificate (needs private_key and certificate) used to act as both server, and client to other brokers

  keystore_password:
    description: "Keystore password"
    default: notasecret

  enable_sasl_scram:
    description: "Whether to use SASL/SCRAM for authentication"
    default: false

  jaas_admin.username:
    description: "admin username used in JAAS configuration"
    default: "admin"

  jaas_admin.password:
    description: "admin password used in JAAS configuration"
    default: "admin-secret"
